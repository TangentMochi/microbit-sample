from microbit import *
import music

song = [[0, 234], [261, 234], [293, 235], [311, 234], [349, 234], [0, 117], [391, 234], [0, 116], [311, 235], [0, 234], [261, 234], [311, 235], [466, 234], [391, 234], [0, 117], [349, 234], [0, 116], [311, 235], [0, 234], [261, 234], [293, 235], [311, 234], [349, 234], [0, 117], [391, 234], [0, 116], [311, 235], [261, 234], [261, 234], [261, 235], [311, 234], [261, 234], [0, 585], [261, 118], [311, 117], [311, 117], [311, 117], [261, 117], [0, 116], [261, 118], [261, 117], [261, 117], [311, 117], [311, 117], [311, 118], [261, 117], [0, 350], [261, 118], [349, 117], [349, 117], [349, 117], [349, 117], [0, 116], [311, 118], [311, 117], [311, 117], [391, 176], [391, 176], [391, 117], [349, 234], [311, 235], [0, 117], [311, 117], [391, 117], [0, 116], [349, 117], [349, 118], [391, 234], [349, 234], [391, 118], [349, 234], [311, 117], [293, 117], [261, 118], [391, 351], [349, 352], [311, 586], [0, 467], [261, 118], [311, 117], [311, 117], [311, 117], [261, 117], [0, 116], [261, 118], [261, 117], [261, 117], [311, 117], [311, 117], [311, 118], [261, 117], [0, 350], [261, 118], [349, 117], [349, 117], [349, 117], [349, 117], [0, 116], [311, 118], [311, 117], [311, 117], [391, 176], [391, 176], [391, 117], [349, 234], [311, 235], [0, 117], [311, 117], [391, 117], [0, 116], [349, 117], [349, 118], [391, 234], [349, 234], [391, 118], [349, 234], [311, 117], [293, 117], [261, 118], [391, 351], [349, 352], [311, 586], [0, 702], [233, 117], [261, 234], [261, 117], [261, 118], [261, 117], [261, 117], [233, 117], [261, 117], [0, 117], [261, 234], [261, 117], [261, 117], [261, 118], [233, 117], [261, 117], [0, 116], [261, 234], [261, 118], [261, 117], [261, 117], [261, 117], [261, 117], [261, 118], [261, 117], [195, 117], [0, 351], [233, 117], [261, 117], [261, 117], [261, 117], [261, 117], [261, 118], [261, 117], [261, 117], [233, 117], [261, 117], [261, 118], [261, 234], [261, 117], [261, 117], [261, 118], [233, 117], [261, 117], [261, 117], [261, 117], [261, 117], [261, 118], [261, 117], [261, 117], [261, 117], [261, 117], [261, 118], [261, 117], [523, 117], [0, 468], [233, 117], [261, 234], [261, 117], [261, 118], [261, 117], [261, 117], [233, 117], [261, 117], [0, 117], [261, 234], [261, 117], [261, 117], [261, 118], [233, 117], [261, 117], [0, 116], [261, 234], [261, 118], [261, 117], [261, 117], [261, 117], [261, 117], [261, 118], [261, 117], [195, 117], [0, 351], [293, 117], [311, 117], [311, 117], [311, 117], [311, 117], [311, 118], [311, 117], [311, 117], [293, 117], [311, 117], [311, 118], [311, 234], [311, 117], [311, 117], [311, 118], [349, 117], [0, 116], [311, 117], [349, 117], [0, 116], [311, 118], [349, 117], [311, 117], [391, 117], [0, 116], [293, 235], [329, 234], [369, 235], [440, 351], [329, 117], [329, 352], [293, 117], [293, 234], [293, 235], [329, 234], [369, 235], [440, 351], [329, 117], [329, 352], [293, 117], [369, 234], [293, 235], [329, 234], [369, 235], [440, 351], [329, 117], [329, 352], [293, 117], [293, 234], [493, 235], [440, 234], [329, 235], [369, 351], [329, 117], [329, 352], [293, 117], [293, 234], [311, 235], [349, 234], [391, 235], [466, 351], [349, 117], [349, 352], [311, 117], [311, 234], [311, 235], [349, 234], [391, 235], [466, 351], [349, 117], [349, 352], [311, 117], [391, 234], [311, 235], [349, 234], [391, 235], [466, 351], [349, 117], [349, 352], [311, 117], [311, 234], [523, 235], [466, 234], [349, 235], [391, 351], [349, 117], [349, 352], [311, 117], [311, 234], [0, 351], [311, 117], [311, 117], [311, 118], [466, 117], [466, 117], [466, 117], [466, 234], [391, 118], [349, 234], [349, 234], [391, 118], [0, 350], [311, 117], [311, 118], [466, 117], [466, 234], [466, 234], [391, 118], [349, 234], [349, 234], [311, 118], [0, 350], [261, 235], [311, 234], [261, 234], [311, 235], [349, 234], [391, 234], [349, 235], [391, 234], [523, 235], [466, 234], [0, 350], [311, 118], [391, 234], [349, 117], [311, 117], [311, 118], [391, 117], [0, 233], [311, 117], [311, 118], [466, 117], [466, 117], [466, 117], [466, 234], [391, 118], [349, 234], [349, 234], [391, 118], [0, 350], [311, 117], [311, 118], [466, 117], [466, 117], [466, 117], [523, 234], [391, 118], [349, 234], [349, 234], [311, 235], [0, 116], [311, 117], [466, 235], [311, 234], [0, 233], [311, 235], [391, 234], [349, 234], [311, 235], [293, 234], [311, 235], [0, 6796], [293, 235], [293, 117], [293, 117], [329, 117], [293, 118], [0, 234], [293, 117], [293, 234], [293, 118], [293, 117], [293, 234], [293, 117], [293, 118], [369, 117], [329, 234], [293, 235], [0, 234], [329, 234], [329, 117], [329, 118], [329, 117], [329, 117], [329, 117], [329, 235], [369, 117], [329, 234], [293, 235], [0, 234], [293, 234], [493, 235], [440, 234], [0, 233], [587, 235], [0, 233], [329, 235], [369, 234], [329, 234], [329, 235], [293, 117], [293, 117], [0, 468], [293, 117], [293, 117], [0, 116], [293, 118], [0, 234], [293, 117], [293, 117], [293, 117], [293, 118], [293, 117], [293, 117], [293, 117], [293, 117], [293, 118], [369, 117], [329, 234], [293, 235], [0, 234], [329, 117], [329, 117], [329, 117], [329, 118], [329, 117], [329, 117], [329, 117], [329, 117], [329, 118], [369, 117], [329, 234], [293, 235], [0, 234], [293, 234], [493, 235], [440, 234], [0, 233], [587, 235], [0, 233], [329, 235], [369, 234], [329, 234], [329, 235], [293, 117], [293, 117], [0, 1054], [233, 117], [261, 234], [261, 117], [261, 118], [261, 117], [261, 117], [233, 117], [261, 117], [0, 117], [261, 234], [261, 117], [261, 117], [261, 118], [233, 117], [261, 117], [0, 116], [261, 234], [261, 118], [261, 117], [261, 117], [261, 117], [261, 117], [261, 118], [261, 117], [195, 117], [0, 351], [233, 117], [261, 117], [261, 117], [261, 117], [261, 117], [261, 118], [261, 117], [261, 117], [233, 117], [261, 117], [261, 118], [261, 234], [261, 117], [261, 117], [261, 118], [233, 117], [261, 117], [261, 117], [261, 117], [261, 117], [261, 118], [261, 117], [261, 117], [261, 117], [261, 117], [261, 118], [261, 117], [523, 117], [0, 468], [233, 117], [261, 234], [261, 117], [261, 118], [261, 117], [261, 117], [233, 117], [261, 117], [0, 117], [261, 234], [261, 117], [261, 117], [261, 118], [233, 117], [261, 117], [0, 116], [261, 234], [261, 118], [261, 117], [261, 117], [261, 117], [261, 117], [261, 118], [261, 117], [195, 117], [0, 351], [293, 117], [311, 117], [311, 117], [311, 117], [311, 117], [311, 118], [311, 117], [311, 117], [293, 117], [311, 117], [311, 118], [311, 234], [311, 117], [311, 117], [311, 118], [349, 117], [0, 116], [311, 117], [349, 117], [0, 116], [311, 118], [349, 117], [311, 117], [391, 117], [0, 116], [277, 235], [311, 234], [349, 235], [415, 351], [311, 117], [311, 352], [277, 117], [277, 234], [277, 235], [311, 234], [349, 235], [415, 351], [311, 117], [311, 352], [277, 117], [349, 234], [277, 235], [311, 234], [349, 235], [415, 351], [311, 117], [311, 352], [277, 117], [277, 469], [277, 234], [311, 235], [349, 351], [311, 117], [311, 352], [277, 117], [277, 234], [0, 7499], [293, 235], [329, 234], [369, 235], [440, 351], [329, 117], [329, 352], [293, 117], [293, 234], [293, 235], [329, 234], [369, 235], [440, 351], [329, 117], [329, 352], [293, 117], [369, 234], [293, 235], [329, 234], [369, 235], [440, 351], [329, 117], [329, 352], [293, 117], [293, 234], [493, 235], [440, 234], [329, 235], [369, 351], [329, 117], [329, 352], [293, 117], [293, 234], [311, 235], [349, 234], [391, 235], [466, 351], [349, 117], [349, 352], [311, 117], [311, 234], [311, 235], [349, 234], [391, 235], [466, 351], [349, 117], [349, 352], [311, 117], [391, 234], [311, 235], [349, 234], [391, 235], [466, 351], [349, 117], [349, 352], [311, 117], [311, 234], [523, 235], [466, 234], [349, 235], [391, 351], [349, 117], [349, 352], [311, 117], [311, 234], [0, 351], [311, 117], [311, 117], [311, 118], [466, 117], [466, 117], [466, 117], [466, 234], [391, 118], [349, 234], [349, 234], [391, 118], [0, 350], [311, 117], [311, 118], [466, 117], [466, 234], [466, 234], [391, 118], [349, 234], [349, 234], [311, 118], [0, 350], [261, 235], [311, 234], [261, 234], [311, 235], [349, 234], [391, 234], [349, 235], [391, 234], [523, 235], [466, 234], [0, 350], [311, 118], [391, 234], [349, 117], [311, 117], [311, 118], [391, 117], [0, 233], [311, 117], [311, 118], [466, 117], [466, 117], [466, 117], [466, 234], [391, 118], [349, 234], [349, 234], [391, 118], [0, 350], [311, 117], [311, 118], [466, 117], [466, 117], [466, 117], [523, 234], [391, 118], [349, 234], [349, 234], [311, 235], [0, 116], [311, 117], [466, 235], [311, 234], [0, 233], [311, 235], [391, 234], [349, 234], [311, 235], [293, 234], [311, 117], [261, 118], [311, 117], [311, 117], [311, 117], [261, 117], [0, 116], [261, 118], [261, 117], [261, 117], [311, 117], [311, 117], [311, 118], [261, 117], [0, 350], [261, 118], [349, 117], [349, 117], [349, 117], [349, 117], [0, 116], [311, 118], [311, 117], [311, 117], [391, 176], [391, 176], [391, 117], [349, 234], [311, 235], [0, 117], [311, 117], [391, 117], [0, 116], [349, 117], [349, 118], [391, 234], [349, 234], [391, 118], [349, 234], [311, 117], [293, 117], [261, 118], [391, 351], [349, 352], [311, 586], [0, 467], [261, 118], [311, 117], [311, 117], [311, 117], [261, 117], [0, 116], [261, 118], [261, 117], [261, 117], [311, 117], [311, 117], [311, 118], [261, 117], [0, 350], [261, 118], [349, 117], [349, 117], [349, 117], [349, 117], [0, 116], [311, 118], [311, 117], [311, 117], [391, 176], [391, 176], [391, 117], [349, 234], [311, 235], [0, 117], [311, 117], [391, 117], [0, 116], [349, 117], [0, 117], [391, 117], [0, 116], [349, 117], [0, 116], [391, 118], [349, 234], [311, 117], [293, 117], [261, 118], [261, 234], [261, 234], [261, 235], [311, 234], [261, 469], [311, 234], [311, 235], [349, 234], [349, 234], [349, 235], [311, 234]]

# タイムアウトかどちらかの入力があるまで待機 返り値 Int
def wait_enter():
    TIMEOUT = 5000
    start_time = running_time()
    while (True):
        if running_time() - start_time > TIMEOUT:
            return 1
        if button_a.is_pressed() or button_b.is_pressed():
            return 0
 
#パスワードを入力 返り値 Bool
def enter_password():
    audio.play(Sound.GIGGLE)
    display.scroll('Enter')
    # 入力回数
    enter_limit = 5
    # TODO 出荷時にパスワードを変更してください
    # 0: 左(A) 1: 右(B)
    password = [0, 0, 1, 0, 1, 1, 0]
    succsess = True
    while (enter_limit != 0):
        succsess = True
        for i in password:
            # 入力待機
            if wait_enter():
                return False
            #ボタンAが押されかつ正しい場合
            if button_a.is_pressed() and i == 0:
                while button_a.is_pressed():
                    pass
            #ボタンBが押されかつ正しい場合
            elif button_b.is_pressed() and i == 1:
                while button_b.is_pressed():
                    pass
            else:
                succsess = False
        if succsess:
            # 認証成功
            display.scroll('Success')
            display.show(Image.YES)
            return True
        else:
            # 認証失敗
            enter_limit -= 1
            audio.play(Sound.SAD)

    display.show(Image.NO)
    audio.play(Sound.MYSTERIOUS)
    return False


while(True):
    # 磁力を取得
    magnet = compass.get_field_strength()
    display.show(Image.SQUARE)
    
    # 500ミリ秒ごとにデータを送信
    if running_time() % 500 == 0:
        print('I:',magnet, sep='')
    
    if 100000 <= magnet:
        # ドアクローズ
        if pin_logo.is_touched():
            # ロゴがタッチされた
            if enter_password():
                print('S:', 0, sep='')
                sleep(5000)
                print('S:', 1, sep='')
    else:
        # ドアオープン
        if enter_password():
            print('S:', 0, sep='')
            while (100000 > magnet):
                magnet = compass.get_field_strength()
            print('S:', 1, sep='')
        else:
            # 通報
            print('E:', 1, sep='')
            music.pitch(880)
            while True:
                continue
